<!DOCTYPE html>
<html>
<head>
    <title>Setting Up the Brightmoor Connection Database</title>
    <style>
        main {
            max-width: 900px;
            margin: auto;
            background-color: #f1f1f1;
            border-radius: 6px;
            border: 2px solid dimgray;
            padding: 20px;
            font-family: Helvetica, sans-serif;
        }

        li {
            line-height: 1.5;
            margin: .25em 0;
        }
	    
	    img {max-width: 100%;}
    </style>
</head>
<body>
<main>
	<img src="img/brightmoor_logo.jpg" alt="Brightmoor Connection Database" />
    <h1>Installation Instructions</h1>
    	<p>The following are instructions on how to set up the Brightmoor Connection database. This is a web application built with the PHP framework <a href="https://symfony.com/">Symfony</a>.
    <h2>Set Up Web Server</h2>
    	<ul>
    		<li>Easy option that works on Windows, Mac and Linux: download and install <a href="https://www.apachefriends.org/index.html">XAMPP</a>. Make sure you install at least Apache, MySQL, PHP, and phpMyAdmin during the installation process. <em>If prompted, allow XAMPP services to run on private networks only (recommended security setting)</em></li>
    	</ul>
    <h2>Create Database</h2>
    <p>You will need to create a MySQL database on your server. There are many ways to do this; I have documented how to do this using XAMPP and phpMyAdmin below:</p>
    <ul>
    	<li>open XAMPP</li>
    	<li>Click Admin in the MySQL row</li>
    	<li>This will open phpMyAdmin in your web browser, which allows you to administer your databases. Click Databases in the top menu, enter a name for your database in the 'Database name' field under 'Create database', then click Create.</li>
    	<li>You have successfully created your database; now we will create the database user. Click Privileges in the top menu.</li>
    	<li>Click Add user account</li>
    	<li>Enter a user name; type <code>localhost</code> in the Host name field; enter a password. Scroll down and under 'Database for user account' check the 'Grant all privileges on database <em>your_database_name</em>' box. Scroll to the bottom of the page and click 'Go' to create the user account.</li>
    </ul>
    <p>You will need the database name, user name and password during application installation (below), when you	 enter this information for the application to connect to the database</p>
    <h2>Install Files</h2>
    <ol>
        <li>Download the application files to your computer.
            <ul>
                <li><a href="https://github.com/richs5812/chirpDatabase2/archive/master.zip">Download the zip file</a>, or clone from the <a href="https://github.com/richs5812/chirpDatabase2">GitHub repository</a></li>
            </ul>
        </li>
        <li>Save the files in a location accessible by your web server. If you are using XAMPP, you will need to save these files inside the <code>xammpp/htdocs</code> folder.</li>
        <li>
            Open up a command line application (e.g. <a href="https://en.wikipedia.org/wiki/Cmd.exe">Command Prompt</a> on Windows, <a href="https://en.wikipedia.org/wiki/Terminal_(macOS)">Terminal</a> on Mac; there is also a built-in shell tool in XAMPP), and navigate to where you saved the files; enter the top level folder (e.g. <code>chirpDatabase2-master</code>). A listing of the files - type <code>ls</code> (Mac/Linux) or <code>dir</code> (Windows) in the command prompt - should show <code>app</code>, <code>bin</code>, <code>src</code>, and <code>web</code> folders, among others if you are in the right place.</li>
        <li>
            <a href="https://getcomposer.org/download/">Install Composer</a> in this folder, if it is not already installed globally on your computer.
        </li>
        <li>Run <code>php composer.phar install</code> to install the remaining files needed to run the application (this will download files into a <code>vendor</code> folder in the project directory). Composer will install files for a few minutes, then ask you for 'parameters' - information needed for the application to access your database, as well as the gmail account needed for the password reset function. Enter database values from the database you created above when prompted (enter <code>localhost</code> or <code>127.0.0.1</code> for <code>database_host</code>, then enter gmail credentials (details needed here...).</li>
        <li>You should really only run into errors here if you forget to enter one of the database or email account values. If you forget to enter one of these, you can add/edit these values in the <code>parameters.yml</code> file located in the <code>app/config</code> directory (I recommend using Notepad++ on Windows, or TextWrangler on Mac to edit this file), then run <code>php composer.phar install</code> again from the command line to try the installation again.</li>
        <li>If you see the message 'All assets were successfully installed' with a green background in your terminal, you are ready to proceed to the next step. If you run into any other errors, contact Rich, or Google the errors to find a solution. You can also refer to Symfony's <a href="https://symfony.com/doc/current/deployment.html">deployment guide</a> for troubleshooting.</li>
        <li>From the command line, run <code>php bin/console cache:clear --env=prod --no-debug --no-warmup</code></li>
        <li>Run <code>php bin/console cache:warmup --env=prod</code></li>
        <li>Once this command finishes running, the application should be installed. You can now open a web browser on your computer and go to <code>http://localhost/your-install-directory/web</code>. For example, if you are using XAMPP, and you installed the project folder (called <code>chirpDatabase2</code> for this example) in <code>xampp/htdocs/chirpDatabase2</code>, you can go to http://localhost/chirpDatabase2/web to access the database. </li>
        <li>Roslyn should be able to log in using her usual username and password. If you need to create a new user account, you must use the command line to do so; a full list of relevant commands can be found <a href="https://symfony.com/doc/current/bundles/FOSUserBundle/command_line_tools.html">here</a>. As an example, to create a new user account, run <code>php bin/console fos:user:create testuser test@example.com p@ssword</code> <em>note that you will need to use <code>bin/console</code> in the command; the website reference uses <code>app/console</code> from an earlier version of Symfony</em>. You must promote this user to a super admin to be able to access the database; run <code>php bin/console fos:user:promote testuser --super</code> to do so. You should now be able to access the database with this user account.</li>
        <li>The database should now be completely set up; contact Rich or search the Internet to resolve any remaining issues.</li>
    </ol>
    
            <h2>Importing the pantry database</h2>
        <ol>
        	<li>Obtain a backup of the database from one of these sources:<li>
        		<ul>
        			<li>The existing pantry computer hard drive</li>
        			<li>The backup hard drive</li>
        			<li>The online backups from spideroak.com (obtain login information from Roslyn</li>
				</ul>
			<li>Import the database backup to the database you set up. The exact method to do this will depend on the tool you are using; below are instructions using phpMyAdmin and XAMPP.</li>
			<li>click Admin in the MySQL row in XAMPP to open phpMyAdmin</li>
			<li>click on your database name in the left hand column</li>
			<li>Click Import from the top menu</li>
			<li>Browse on your computer for the backup file (this will be a .sql file).</li>
			<li>Once you have selected the file, scroll to the bottom of the phpMyAdmin screen and click 'Go'</li>
			</li>You should see a success message. The import is complete</li>
        </ol>
        
</main>

</body>
</html>
