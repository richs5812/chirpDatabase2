<!DOCTYPE html>
<html>
<head>
    <title>Setting Up the Brightmoor Connection Database</title>
    <style>
        main {
            max-width: 900px;
            margin: auto;
            background-color: #f1f1f1;
            border-radius: 6px;
            border: 2px solid dimgray;
            padding: 20px;
            font-family: Helvetica, sans-serif;
        }

        li {
            line-height: 1.5;
            margin: .25em 0;
        }
        
        p {
        	line-height: 1.2;
        }
	    
	    img {max-width: 100%;}
    </style>
</head>
<body>
<main>
	<img src="img/brightmoor_logo.jpg" alt="Brightmoor Connection Database" />
    <h1>Brightmoor Connection Database Documentation</h1>
    	<p>Below is documentation for the Brightmoor Connection database web application, built using the PHP framework <a href="https://symfony.com/">Symfony</a>. There are two main sections: 1) <a href="#application-installation">Application Installation</a>, and 2) <a href="#restoring-backup">Restoring the Database From a Backup</a>.</p>

	<h2 id="application-installation">Application Installation</h1>
	<p>The three main steps in installing the database application are:</p>
	<ol>
		<li><a href="#set-up-server">Set up a web server</a></li>
		<li><a href="#create-database">Create a MySQL database</a></li>
		<li><a href="#download-install">Download and install the application files</a></li>
	</ol>
    <h3 id="set-up-server">1. Set Up a Web Server</h3>
    	<p><em>These instructions will assume you are installing the database application locally on a computer; however, it could also be installed on a third-party web server hosted by a company like GoDaddy, Bluehost, etc., and accessed by the pantry over the Internet. To date, the pantry has only used a locally installed version using XAMPP.</em></p>
    	<p>There are many ways to set up a web server to run locally on one computer. The easiest option that works on Windows, Mac and Linux is to download and install <a href="https://www.apachefriends.org/index.html">XAMPP</a>. During the installation process, make sure you install at least Apache, MySQL, PHP, and phpMyAdmin. <em>If prompted, allow XAMPP services to run on private networks only (recommended security setting)</em>.</p>
    <h3 id="create-database">2. Create a MySQL Database</h3>
    <p>You will need to create a MySQL database on your server. There are many ways to do this; if you installed XAMPP, you can follow the instructions below:</p>
    <ol>
    	<li>Open XAMPP</li>
    	<li>Click Start in the MySQL row to start MySQL, then click Admin in the same row. This will open phpMyAdmin in your web browser, which allows you to administer your databases.</li>
    	<li>Click Databases in the top menu, enter a name for your database in the 'Database name' field under 'Create database', then click Create. This will create the database.</li>
    	<li>To create the database user, click 'Privileges' in the top menu.</li>
    	<li>Click 'Add user account'.</li>
    	<li>Enter a user name; type <code>localhost</code> in the Host name field; enter a password. Scroll down, and check the 'Grant all privileges on database <em>your_database_name</em>' box under 'Database for user account'. Scroll to the bottom of the page and click 'Go' to create the user account.</li>
    </ol>
    <p>The database and user are now created. You will need the database name, user name and password during application installation (below).</p>
    <h3 id="download-install">3. Download and Install the Application Files</h3>
    <ol>
        <li>Download the application files to your computer.
            <ul>
                <li><a href="https://github.com/richs5812/chirpDatabase2/archive/master.zip">Download the zip file</a>, or clone from the <a href="https://github.com/richs5812/chirpDatabase2">GitHub repository</a></li>
            </ul>
        </li>
        <li>Save the files in a location accessible by your web server. If you are using XAMPP, you will need to save these files inside the <code>xammpp/htdocs</code> folder.</li>
        <li>
            Open up a command line application (e.g. <a href="https://en.wikipedia.org/wiki/Cmd.exe">Command Prompt</a> on Windows, <a href="https://en.wikipedia.org/wiki/Terminal_(macOS)">Terminal</a> on Mac; there is also a built-in shell tool in XAMPP), and navigate to where you saved the files; enter the top level folder (e.g. <code>chirpDatabase2-master</code>). List the files in the folder by running the command <code>ls</code> if you are on Mac or Linux, or <code>dir</code> if you are on Windows. Your terminal application should show <code>app</code>, <code>bin</code>, <code>src</code>, and <code>web</code> folders, among others if you are in the right place.</li>
        <li>
            <a href="https://getcomposer.org/download/">Install Composer</a> in this folder, if it is not already installed globally on your computer.
        </li>
        <li>Run <code>php composer.phar install</code> to install the remaining files needed to run the application (this will download files into a <code>vendor</code> folder in the project directory). Composer will install files for several minutes, then ask you for login credentials to your database, and the gmail account used by the application's 'forgot password' function. When prompted, enter the following values:
        <ul>
        	<li><code>database_name</code>: the database name you created</li>
        	<li><code>database_user</code>: the database user you created</li>
        	<li><code>database_password</code>: the database password you created</li>
        	<li><code>mailer_transport</code>: <code>gmail</code></li>
        	<li><code>mailer_user</code>: enter value from <a href="img/Screen-Shot-2017-08-06.png">here</a></li>
        	<li><code>mailer_password</code>: enter value from <a href="img/Screen-Shot-2017-08-06.png">here</a> (no quotes needed when entering in command prompt)</li>
        </ul>

         For all other values, accept the default value by simply hitting the Enter key when prompted. <br />
         <span style="display:block; margin: .5em 0;"><em>Note</em>: If you forget or skip entering one of these values, you may encounter an error. If this happens, you can add or edit these values in the <code>parameters.yml</code> file located in the <code>app/config</code> directory (I recommend using Notepad++ on Windows, or TextWrangler on Mac to edit this file). Then run <code>php composer.phar install</code> from the command line to try the installation again.</span></li>
        <li>If you see the message 'All assets were successfully installed' with a green background in your terminal, you are ready to proceed to the next step. If you run into any other errors, contact <a href="#contact">Rich</a>, or Google the errors to find a solution. You can also refer to Symfony's <a href="https://symfony.com/doc/current/deployment.html">deployment guide</a> for troubleshooting.</li>
        <li>From the command line, run <code>php bin/console cache:clear --env=prod --no-debug --no-warmup</code></li>
        <li>Run <code>php bin/console cache:warmup --env=prod</code></li>
        <li>Once this command finishes running, the application should be installed. You can now open a web browser on your computer and go to <code>http://localhost/your-install-directory/web</code>. For example, if you are using XAMPP, and you installed the project folder (called <code>chirpDatabase2-master</code> for this example) at <code>xampp/htdocs/chirpDatabase2-master</code>, you can go to http://localhost/chirpDatabase2-master/web to access the database. </li>
        <li>Roslyn should be able to log in using her usual username and password. If you need to create a new user account, run the following command line commands (replace the dummy values with your values):
        	<ul>
        		<li><code>php bin/console fos:user:create testuser test@example.com p@ssword</code></li>
        		<li><code>php bin/console fos:user:promote testuser --super</code> (this command is required to give the user full access to the database)</li>
	        </ul>
        
		These and other commands related to user management can be found <a href="https://symfony.com/doc/current/bundles/FOSUserBundle/command_line_tools.html">here</a>. <em>Note that this website uses <code>app/console</code> from an earlier version of Symfony; you should replace this with <code>bin/console</code> in your commands.</em></li>
		<li>XAMPP must be running with Apache and MySQL for the database application to run, so you should Configure XAMPP to start on login, and for Apache and MySQL to start when XAMPP starts up.</li>
		<li>Configure an automated backup system. I have created a Windows .bat file that outputs a copy of the database and uses Windows batch files to run this command every hour. This file can be found here:</li>
        <li>The database should now be completely set up; contact <a href="#contact">Rich</a> or search the Internet to resolve any remaining issues.</li>
    </ol>
    
	<h2 id="restoring-backup">Restoring the Database From a Backup</h2>
        <ol>
        	<li>Obtain a backup of the database from one of these sources (this will be a .sql file):
        		<ul>
        			<li>The existing pantry computer hard drive</li>
        			<li>The backup hard drive</li>
        			<li>The online backups from spideroak.com (obtain login information from Roslyn or <a href="#contact">Rich</a>)</li>
				</ul>
			</li>
			<li>Save the .sql file on your computer</li>
			<li>Import the .sql file into your database. The exact method to do this will depend on the tool you are using; below are instructions using phpMyAdmin and XAMPP.</li>
			<li>If not already started, click Start in the MySQL row in XAMPP to start MySQL.</li>
			<li>Click Admin in the MySQL row to open phpMyAdmin.</li>
			<li>Click on your database name in the left hand column.</li>
			<li>Click Import from the top menu.</li>
			<li>Browse on your computer for the backup file you saved in an earlier step.</li>
			<li>Once you have selected the file, scroll to the bottom of the phpMyAdmin screen and click 'Go'.</li>
			</li>You should see a success message. The import is complete</li>
        </ol>
        
    <h2 id="contact">Contact</h2>
    <p>Rich Samartino</p>
    <img src="img/contact.png" />
        
</main>

</body>
</html>
